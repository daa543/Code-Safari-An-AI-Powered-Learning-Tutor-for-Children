<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Code Safari</title>
    <link rel="stylesheet" href="style_main.css">
    <!-- <link rel="stylesheet" href="{{ url_for('static', filename='style_code.css') }}"/> -->
    <!-- Add these BEFORE your existing scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- Add syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- Add code_snippet.js for Python tutor -->
    <!-- <script src=".js"></script> -->
    <style>
        /* * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f8fafc;
            margin: 0;
            padding: 0;
        } */

        .main-content {
            padding: 2rem;
        }

        .welcome-banner {
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
            padding: 2rem;
            border-radius: 1rem;
            color: white;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        .welcome-banner::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/><circle cx="50" cy="10" r="0.5" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            pointer-events: none;
        }

        .animated-text {
            background: linear-gradient(90deg, #fff, #f0f9ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .welcome-subtitle {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 1.5rem;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .stat-icon {
            font-size: 2.5rem;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
        }

        .stat-icon.xp {
            background: linear-gradient(135deg, #f59e0b, #f97316);
        }

        .stat-icon.exercises {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .stat-icon.games {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }

        .stat-icon.videos {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }

        .stat-info h3 {
            margin: 0;
            color: #64748b;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin: 0.5rem 0 0 0;
            color: #1e293b;
        }

        .stat-subtext {
            font-size: 0.8rem;
            color: #64748b;
            margin-top: 0.25rem;
        }

        .progress-section {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .progress-ring {
            position: relative;
            width: 80px;
            height: 80px;
        }

        .progress-ring-circle {
            fill: transparent;
            stroke: #e2e8f0;
            stroke-width: 8;
        }

        .progress-ring-circle.progress {
            stroke: #10b981;
            stroke-linecap: round;
            transform: rotate(-90deg);
            transform-origin: center;
            transition: stroke-dashoffset 1s ease;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            font-size: 1rem;
            color: #1e293b;
        }

        .badges-section {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .badge {
            background: white;
            padding: 1rem;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease;
        }

        .badge:hover {
            transform: scale(1.05);
        }

        .badge.earned {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
        }

        .badge.locked {
            opacity: 0.5;
            background: #f1f5f9;
        }

        .badge-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .badge-name {
            font-size: 0.8rem;
            font-weight: 600;
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .game-card {
            /* background: linear-gradient(to bottom, #10b981, #34d399); */
            color: white;
            padding: 1.5rem;
            border-radius: 1rem;
            position: relative;
            overflow: hidden;
        }

        .game-card-Dash {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 1rem;
            position: relative;
            overflow: hidden;
        }

        .game-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            transform: translate(30px, -30px);
        }

        .game-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .game-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            font-size: 0.9rem;
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #e2e8f0;
            border-radius: 50%;
            border-top-color: #6366f1;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .error-message {
            background: #fef2f2;
            color: #dc2626;
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid #fecaca;
            margin: 1rem 0;
        }

        .level-badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #059669);
            transition: width 1s ease;
            width: 0%;
        }

        .stat-trend {
            font-size: 0.7rem;
            color: #10b981;
            font-weight: 600;
        }

        .achievement-popup {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .achievement-popup.show {
            transform: translateX(0);
        }

        .overall-progress-container {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .progress-ring-container {
            position: relative;
            flex-shrink: 0;
        }

        .progress-details {
            flex: 1;
            min-width: 0;
        }

        .current-lesson {
            color: #1e293b;
            font-size: 1.3rem;
            font-weight: 700;
            margin: 0 0 0.75rem 0;
        }

        .progress-description {
            color: #64748b;
            font-size: 1rem;
            line-height: 1.5;
            margin: 0 0 1rem 0;
        }

        .progress-encouragement {
            display: inline-flex;
            align-items: center;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            font-weight: 600;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 1rem;
            }

            .dashboard-stats {
                grid-template-columns: 1fr;
            }

            /* .games-grid {
                grid-template-columns: 1fr;
            } */
        }
    </style>
</head>

<body>
    <div class="layout">
        <aside class="sidebar">
            <!-- Logo -->
            <div class="logo">
                <!-- <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="logo-icon">
            <path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z"/>
            <path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"/>
          </svg> -->
                <span class="logo-text">Code Safariüå¥</span>
            </div>

            <!-- Navigation -->
            <nav class="nav">
                <div class="nav-section">
                    <h3 class="nav-title">Main</h3>
                    <button class="nav-item active" data-page="dashboard">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                            <polyline points="9 22 9 12 15 12 15 22" />
                        </svg>
                        <span>Dashboard</span>
                    </button>
                    <button class="nav-item" data-page="video-lessons">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="m22 8-6 4 6 4V8Z" />
                            <rect x="2" y="6" width="14" height="12" rx="2" ry="2" />
                        </svg>
                        <span>Video Lessons</span>
                    </button>
                    <button class="nav-item" data-page="python-assistant">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 8V4H8" />
                            <rect x="4" y="4" width="16" height="16" rx="2" />
                            <path d="M2 14h2" />
                            <path d="M20 14h2" />
                            <path d="M15 13v2" />
                            <path d="M9 13v2" />
                        </svg>
                        <span>Python Assistant</span>
                    </button>
                </div>

                <div class="nav-section">
                    <h3 class="nav-title">Learning</h3>
                    <button class="nav-item" data-page="code-games">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="6" y1="11" x2="10" y2="11" />
                            <line x1="8" y1="9" x2="8" y2="13" />
                            <line x1="15" y1="12" x2="15" y2="12" />
                            <line x1="18" y1="10" x2="18" y2="10" />
                            <path d="M17.6 14h.012" />
                            <rect x="2" y="6" width="20" height="12" rx="2" />
                        </svg>
                        <span>Debugging Detective</span>
                    </button>
                    <!-- <button class="nav-item" data-page="my-courses">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M22 10v6M2 10l10-5 10 5-10 5z"/>
                <path d="M6 12v5c3 3 9 3 12 0v-5"/>
              </svg>
              <span>My Courses</span>
            </button> -->
                    <button class="nav-item" data-page="exercises">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" />
                            <polyline points="14 2 14 8 20 8" />
                            <line x1="10" y1="13" x2="14" y2="13" />
                            <line x1="10" y1="17" x2="14" y2="17" />
                            <line x1="8" y1="13" x2="8" y2="13" />
                            <line x1="8" y1="17" x2="8" y2="17" />
                        </svg>
                        <span>Exercises</span>
                    </button>
                    <button class="nav-item" data-page="coding">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="16 18 22 12 16 6"></polyline>
                            <polyline points="8 6 2 12 8 18"></polyline>
                        </svg>
                        <span>Coding</span>
                    </button>
                    <!-- <button class="nav-item" data-page="achievements">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/>
                <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/>
                <path d="M4 22h16"/>
                <path d="M10 14.66V17c0 .55-.47.98-.97.93l-2-.2c-.41-.04-.753-.34-.793-.75L6 14.77a.993.993 0 0 1 .99-1.077H9c.55 0 1 .45 1 1v-.033"/>
                <path d="M14 14.66V17c0 .55.47.98.97.93l2-.2c.41-.04.753-.34.793-.75L18 14.77a.993.993 0 0 0-.99-1.077H15c-.55 0-1 .45-1 1v-.033"/>
                <path d="M12 8v4"/>
                <path d="M12 3v3"/>
              </svg>
              <span>Achievements</span>
            </button> -->
                    <button class="nav-item" data-page="ai-artist" onclick="loadAIArtistGame()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M2 12C2 6.5 6.5 2 12 2a10 10 0 0 1 8 4"></path>
                            <path d="M5 19.5C5.5 18 6 15 6 12c0-.7.12-1.37.34-2"></path>
                            <path d="M17.29 21.02c.12-.6.43-2.3.5-3.02"></path>
                            <path d="M12 10a2 2 0 0 0-2 2c0 1.02-.1 2.51-.26 4"></path>
                            <path d="M8.65 22c.21-.66.45-1.32.57-2"></path>
                            <path d="M14 13.12c0 2.38 0 6.38-1 8.88"></path>
                            <path d="M2 16h.01"></path>
                            <circle cx="18" cy="18" r="4"></circle>
                            <path d="M18 14.5v7"></path>
                            <path d="M14.5 18h7"></path>
                        </svg>
                        <span>AI Artist</span>
                    </button>


                </div>

                <div class="nav-section">
                    <h3 class="nav-title">Progress</h3>


                    <!-- <button class="nav-item" data-page="my-progress">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M3 3v18h18"/>
                  <path d="m19 9-5 5-4-4-3 3"/>
              </svg>
              <span>My Progress</span>
            </button> -->


                    <button class="nav-item" data-page="settings">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path
                                d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z" />
                            <circle cx="12" cy="12" r="3" />
                        </svg>
                        <span>Settings</span>
                    </button>
                    <button class="nav-item" data-page="help-support">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10" />
                            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" />
                            <path d="M12 17h.01" />
                        </svg>
                        <span>Help & Support</span>
                    </button>
                </div>
            </nav>

            <!-- Logout -->
            <button class="logout">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                    <polyline points="16 17 21 12 16 7" />
                    <line x1="21" y1="12" x2="9" y2="12" />
                </svg>
                <span>Logout</span>
            </button>
        </aside>

        <main class="main-content">



            <!-- Dashboard Page -->


            <div id="dashboard" class="page active">
                <div class="welcome-banner">
                    <h1 class="animated-text" id="welcomeText">Welcome back, Coder!</h1>
                    <p class="welcome-subtitle" id="welcomeSubtitle">Ready to continue your coding adventure?</p>
                </div>

                <!-- Loading State -->
                <div id="loading" style="text-align: center; padding: 2rem;">
                    <div class="loading-spinner"></div>
                    <p style="margin-top: 1rem; color: #64748b;">Loading your progress...</p>
                </div>

                <!-- Error State -->
                <div id="errorMessage" class="error-message" style="display: none;"></div>

                <!-- Dashboard Content -->
                <div id="dashboardContent" style="display: none;">
                    <!-- Stats Cards -->
                    <div class="dashboard-stats">
                        <div class="stat-card">
                            <div class="stat-icon xp">üèÜ</div>
                            <div class="stat-info">
                                <h3>Total XP</h3>
                                <p class="stat-value" id="totalXP">0</p>
                                <p class="stat-subtext" id="xpTrend">+0 this week</p>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon exercises">‚úÖ</div>
                            <div class="stat-info">
                                <h3>Exercises Completed</h3>
                                <p class="stat-value" id="exercisesCompleted">0</p>
                                <p class="stat-subtext" id="exerciseScore">0 total points</p>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon games">üéÆ</div>
                            <div class="stat-info">
                                <h3>Games Played</h3>
                                <p class="stat-value" id="gamesPlayed">0</p>
                                <p class="stat-subtext" id="gameScore">0 total score</p>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon videos">üìπ</div>
                            <div class="stat-info">
                                <h3>Video Progress</h3>
                                <div class="progress-ring">
                                    <svg width="80" height="80">
                                        <circle class="progress-ring-circle" cx="40" cy="40" r="36"></circle>
                                        <circle class="progress-ring-circle progress" cx="40" cy="40" r="36"
                                            id="videoProgressRing"></circle>
                                    </svg>
                                    <div class="progress-text" id="videoProgressText">0%</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Badges Section -->
                    <div class="progress-section">
                        <h2 class="section-title">üèÖ Achievements & Badges</h2>
                        <div class="badges-section" id="badgesContainer">
                            <!-- Badges will be populated dynamically -->
                        </div>
                    </div>

                    <!-- Games Progress -->
                    <div class="progress-section">
                        <h2 class="section-title">üéÆ Games Progress</h2>
                        <div class="games-grid">
                            <div class="game-card-Dash">
                                <div class="game-title">üïµÔ∏è Debugging Detective</div>
                                <div class="level-badge" id="debuggingLevel">Level 1</div>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="debuggingProgress" style="width: 0%"></div>
                                </div>
                                <div class="game-stats">
                                    <span>Score: <span id="debuggingScore">0</span></span>
                                    <span>Challenges: <span id="debuggingChallenges">0</span></span>
                                </div>
                            </div>

                            <div class="game-card"
                                style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                                <div class="game-title">üíª Coding Exercise</div>
                                <div class="level-badge" id="codingBestScore">Best: 0</div>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="codingProgress" style="width: 0%"></div>
                                </div>
                                <div class="game-stats">
                                    <span>Score: <span id="codingScore">0</span></span>
                                    <span>Solved: <span id="problemsSolved">0</span></span>
                                </div>
                            </div>

                            <div class="game-card"
                                style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                                <div class="game-title">üé® AI Artist</div>
                                <div class="level-badge" id="aiArtistLevel">Creative</div>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="aiArtistProgress" style="width: 0%"></div>
                                </div>
                                <div class="game-stats">
                                    <span>Created: <span id="visualizationsCreated">0</span></span>
                                    <span>Rank: <span id="artistRank">Beginner</span></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Overall Progress -->
                    <div class="progress-section">
                        <h2 class="section-title">üìä Overall Progress</h2>
                        <div class="overall-progress-container">
                            <div class="progress-ring-container">
                                <svg width="120" height="120">
                                    <circle class="progress-ring-circle" cx="60" cy="60" r="54" stroke-width="12">
                                    </circle>
                                    <circle class="progress-ring-circle progress" cx="60" cy="60" r="54"
                                        stroke-width="12" id="overallProgressRing"></circle>
                                </svg>
                                <div class="progress-text" id="overallProgressText" style="font-size: 1.2rem;">0%</div>
                            </div>
                            <div class="progress-details">
                                <h3 class="current-lesson">Current Lesson: <span id="currentLesson">1</span></h3>
                                <p class="progress-description">Keep up the great work! You're making excellent progress
                                    on your coding journey.</p>
                                <div class="progress-encouragement">
                                    <span id="progressEncouragement">Just getting started!</span>
                                </div>
                            </div>
                        </div>
                    </div>


                    <!-- Achievement Popup -->
                    <div class="achievement-popup" id="achievementPopup">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <span style="font-size: 1.5rem;">üèÜ</span>
                            <span id="achievementText">New Achievement Unlocked!</span>
                        </div>
                    </div>
                </div>
            </div>



            <div id="ai-artist" class="page">
                <h1>AI Artist Game</h1>
                <p class="subtitle">Create amazing visualizations with AI</p>

                <!-- Container for the AI Artist game -->
                <div id="ai-artist-game-container" style="display: none; margin-top: 30px;">
                </div>
            </div>


            <!-- Video Lessons Page with Pagination -->
            <div id="video-lessons" class="page">
                <h1>Python Video Lessons</h1>
                <p class="subtitle">Learn through comprehensive video tutorials</p>

                <!-- Progress indicator -->
                <div class="lesson-progress">
                    <div class="progress-steps">
                        <div class="step active" data-lesson="1">1</div>
                        <div class="step" data-lesson="2">2</div>
                        <div class="step" data-lesson="3">3</div>
                        <div class="step" data-lesson="4">4</div>
                        <div class="step" data-lesson="5">5</div>
                        <div class="step" data-lesson="6">6</div>
                        <div class="step" data-lesson="7">7</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-bar-fill" style="width: 14.3%"></div>
                    </div>
                </div>

                <!-- Lesson Container -->
                <div class="lesson-container">
                    <!-- Lesson 1: Introduction to Python -->
                    <div class="lesson active" data-lesson="1">
                        <div class="video-card">
                            <div class="video-container">
                                <iframe width="100%" height="500" src="https://www.youtube.com/embed/Nj-L0FC2c0U"
                                    title="Introduction to Python" frameborder="0"
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                    allowfullscreen>
                                </iframe>
                            </div>
                            <div class="lesson-content">
                                <h2>Introduction to Python</h2>
                                <p>Learn the basics of Python programming - what it is, why it's popular, and how to
                                    get started.</p>
                                <span class="duration">45 mins</span>
                                <button class="btn generate-content" data-video-id="Nj-L0FC2c0U"
                                    data-video-title="Introduction to Python">
                                    üìö Create Learning Materials
                                </button>

                                <div class="content-viewer">
                                    <h3>üìñ Study Guide</h3>
                                    <div class="lecture-output" style="display: none;"></div>

                                    <h3>üöÄ Quick Reference</h3>
                                    <div class="cheatsheet-output" style="display: none;"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Lesson 2: Variables -->
                    <div class="lesson" data-lesson="2">
                        <div class="video-card">
                            <div class="video-container">
                                <iframe width="100%" height="500" src="https://www.youtube.com/embed/mQamOwiW3iM"
                                    title="Python Variables" frameborder="0"
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                    allowfullscreen>
                                </iframe>
                            </div>
                            <div class="lesson-content">
                                <h2>Python Variables</h2>
                                <p>Understanding variables and data types in Python programming.</p>
                                <span class="duration">30 mins</span>
                                <button class="btn generate-content" data-video-id="mQamOwiW3iM"
                                    data-video-title="Python Variables">
                                    üìö Create Learning Materials
                                </button>

                                <div class="content-viewer">
                                    <h3>üìñ Study Guide</h3>
                                    <div class="lecture-output" style="display: none;"></div>

                                    <h3>üöÄ Quick Reference</h3>
                                    <div class="cheatsheet-output" style="display: none;"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Lesson 3: Loops -->
                    <div class="lesson" data-lesson="3">
                        <div class="video-card">
                            <div class="video-container">
                                <iframe width="100%" height="500" src="https://www.youtube.com/embed/fAr6EMp0SSc"
                                    title="Python Loops" frameborder="0"
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                    allowfullscreen>
                                </iframe>
                            </div>
                            <div class="lesson-content">
                                <h2>Python Loops</h2>
                                <p>Master for and while loops in Python programming.</p>
                                <span class="duration">40 mins</span>
                                <button class="btn generate-content" data-video-id="fAr6EMp0SSc"
                                    data-video-title="Python Loops">
                                    üìö Create Learning Materials
                                </button>

                                <div class="content-viewer">
                                    <h3>üìñ Study Guide</h3>
                                    <div class="lecture-output" style="display: none;"></div>

                                    <h3>üöÄ Quick Reference</h3>
                                    <div class="cheatsheet-output" style="display: none;"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Lesson 4: Conditionals -->
                    <div class="lesson" data-lesson="4">
                        <div class="video-card">
                            <div class="video-container">
                                <iframe width="100%" height="500" src="https://www.youtube.com/embed/w826p9clLeA"
                                    title="Python Conditionals" frameborder="0"
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                    allowfullscreen>
                                </iframe>
                            </div>
                            <div class="lesson-content">
                                <h2>Python Conditionals</h2>
                                <p>Learn if statements and decision making in Python.</p>
                                <span class="duration">35 mins</span>
                                <button class="btn generate-content" data-video-id="w826p9clLeA"
                                    data-video-title="Python Conditionals">
                                    üìö Create Learning Materials
                                </button>

                                <div class="content-viewer">
                                    <h3>üìñ Study Guide</h3>
                                    <div class="lecture-output" style="display: none;"></div>

                                    <h3>üöÄ Quick Reference</h3>
                                    <div class="cheatsheet-output" style="display: none;"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Lesson 5: String Manipulation -->
                    <div class="lesson" data-lesson="5">
                        <div class="video-card">
                            <div class="video-container">
                                <iframe width="100%" height="500" src="https://www.youtube.com/embed/BEMoUK9BBIA"
                                    title="String Manipulation" frameborder="0"
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                    allowfullscreen>
                                </iframe>
                            </div>
                            <div class="lesson-content">
                                <h2>String Manipulation</h2>
                                <p>Working with text data in Python programming.</p>
                                <span class="duration">25 mins</span>
                                <button class="btn generate-content" data-video-id="BEMoUK9BBIA"
                                    data-video-title="String Manipulation">
                                    üìö Create Learning Materials
                                </button>

                                <div class="content-viewer">
                                    <h3>üìñ Study Guide</h3>
                                    <div class="lecture-output" style="display: none;"></div>

                                    <h3>üöÄ Quick Reference</h3>
                                    <div class="cheatsheet-output" style="display: none;"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Lesson 6: Functions -->
                    <div class="lesson" data-lesson="6">
                        <div class="video-card">
                            <div class="video-container">
                                <iframe width="100%" height="500" src="https://www.youtube.com/embed/XOfNHCGfJEM"
                                    title="Python Functions" frameborder="0"
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                    allowfullscreen>
                                </iframe>
                            </div>
                            <div class="lesson-content">
                                <h2>Python Functions</h2>
                                <p>Creating reusable code blocks with functions.</p>
                                <span class="duration">45 mins</span>
                                <button class="btn generate-content" data-video-id="XOfNHCGfJEM"
                                    data-video-title="Python Functions">
                                    üìö Create Learning Materials
                                </button>

                                <div class="content-viewer">
                                    <h3>üìñ Study Guide</h3>
                                    <div class="lecture-output" style="display: none;"></div>

                                    <h3>üöÄ Quick Reference</h3>
                                    <div class="cheatsheet-output" style="display: none;"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Lesson 7: Operators -->
                    <div class="lesson" data-lesson="7">
                        <div class="video-card">
                            <div class="video-container">
                                <iframe width="100%" height="500" src="https://www.youtube.com/embed/qQHl0VqM8Ac"
                                    title="Python Operators" frameborder="0"
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                    allowfullscreen>
                                </iframe>
                            </div>
                            <div class="lesson-content">
                                <h2>Python Operators</h2>
                                <p>Arithmetic, comparison, and logical operators in Python.</p>
                                <span class="duration">35 mins</span>
                                <button class="btn generate-content" data-video-id="qQHl0VqM8Ac"
                                    data-video-title="Python Operators">
                                    üìö Create Learning Materials
                                </button>

                                <div class="content-viewer">
                                    <h3>üìñ Study Guide</h3>
                                    <div class="lecture-output" style="display: none;"></div>

                                    <h3>üöÄ Quick Reference</h3>
                                    <div class="cheatsheet-output" style="display: none;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Navigation buttons -->
                <div class="lesson-navigation">
                    <button class="btn nav-btn" id="prevLesson" disabled>‚¨ÖÔ∏è Previous Lesson</button>
                    <button class="btn nav-btn" id="nextLesson">Next Lesson ‚û°Ô∏è</button>
                </div>
            </div>

            <!-- Python Assistant Page -->
            <div id="python-assistant" class="page">
                <h1>Python Assistant</h1>
                <p class="subtitle">Your AI-powered Python learning companion</p>

                <div class="chat-container">
                    <div class="chat-messages">
                        <!-- Messages will be added here dynamically -->
                    </div>

                    <div class="chat-input">
                        <textarea placeholder="Ask me anything about Python..." class="message-input"></textarea>
                        <button class="btn send-message">Send</button>
                    </div>
                </div>
            </div>

            <!-- Code Games Page -->
            <div id="code-games" class="page">
                <h1>Debugging Detective</h1>
                <!-- <p class="subtitle">Learn coding through fun interactive games</p> -->

                <div class="games-grid">
                    <div class="game-card detective-card">
                        <h3>Debugging Detective</h3>
                        <p>Solve coding puzzles by finding and fixing bugs in Python code</p>
                        <p>Perfect for ages 10-13 to learn programming concepts!</p>
                        <br>
                        <button class="btn" onclick="loadDebuggingDetective()">Play Now</button>
                    </div>
                </div>

                <!-- NEW GAME: AI Artist Programming Game -->
                <!-- <div class="game-card">
              <h3>AI Artist Programming Game</h3>
              <p>Learn loops and functions by programming an AI artist that draws on canvas</p>
              <p>Use multimodal AI to get feedback on your code and artwork!</p>
              <br>
              <button class="btn" onclick="loadAIArtistGame()">Play Now</button>
            </div>
          </div> -->

                <!-- Container for the Debugging Detective game -->
                <div id="debugging-detective-container" style="display: none; margin-top: 30px;">
                    <!-- The game will be loaded here -->
                    <div class="game-container">
                        <div class="detective-header">
                            <h1>üïµÔ∏è‚Äç‚ôÇÔ∏è Debugging Detective üïµÔ∏è‚Äç‚ôÄÔ∏è</h1>
                            <p>Find and fix the bugs to solve the case!</p>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <h4 id="levelTitle">Case #1: The Missing Loop</h4>
                                <span id="difficultyBadge" class="difficulty-badge easy">Easy</span>
                            </div>
                            <div class="col-md-6 text-end">
                                <span>Score: <span id="score">0</span></span>
                            </div>
                        </div>

                        <div class="progress-container">
                            <div class="progress">
                                <div id="levelProgress" class="progress-bar" role="progressbar" style="width: 0%">
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12">
                                <div class="card mb-3">
                                    <div class="card-header">
                                        <h5>Case Description</h5>
                                    </div>
                                    <div class="card-body">
                                        <p id="challengeDescription">Find what's wrong with this code that should
                                            print numbers from 1 to 5.</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12">
                                <div class="card mb-3">
                                    <div class="card-header">
                                        <h5>Code with Bugs</h5>
                                    </div>
                                    <div class="card-body">
                                        <div id="codeEditor"
                                            style="width: 100%; height: 250px; font-family: 'Courier New', monospace;">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="hintBox" class="hint-box" style="display: none;">
                            <h5>Detective Hint:</h5>
                            <p id="hintText"></p>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-12 d-flex justify-content-between">
                                <button id="hintBtn" class="btn btn-hint">Need a Hint? üí°</button>
                                <div>
                                    <button id="submitBtn" class="btn btn-submit me-2">Submit Solution üîç</button>
                                    <button id="nextBtn" class="btn btn-next" style="display: none;">Next Case
                                        üëâ</button>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>Feedback</h5>
                                    </div>
                                    <div class="card-body">
                                        <div id="feedbackArea">Solve the case to get feedback!</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row mt-4">
                            <div class="col-md-12">
                                <h5>Your Detective Badges</h5>
                                <div class="badge-container" id="badgeContainer">
                                    <!-- Badges will be added here dynamically -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="celebration" id="celebration">
                        <div class="celebration-content">
                            <h2>Amazing Work, Detective! üéâ</h2>
                            <p id="celebrationText">You've solved the case!</p>
                            <button class="btn btn-primary"
                                onclick="document.getElementById('celebration').style.display='none'">Continue</button>
                        </div>
                    </div>

                    <button class="btn btn-secondary mt-4" onclick="hideDebuggingDetective()">Back to Games</button>
                </div>

                <!-- Container for the AI Artist game -->
                <div id="ai-artist-game-container" style="display: none; margin-top: 30px;">
                    <!-- The AI Artist game will be loaded here -->
                </div>
            </div>


            <!-- Code Snippets Page - NEW PAGE FOR CODEGEN TUTOR -->


            <!-- Code Exercise Page -->
            <div id="coding" class="page">
                <h1>üß† Coding Exercise</h1>
                <p class="subtitle">Challenge yourself with coding problems</p>

                <div class="exercise-container">
                    <div class="problem-container">
                        <h3>Problem</h3>
                        <div id="problem" class="problem-description"></div>
                    </div>

                    <div class="solution-container">
                        <h3>‚úçÔ∏è Your Solution</h3>
                        <textarea id="user_code" placeholder="Write your solution here..."></textarea>
                    </div>

                    <div class="button-container">
                        <button class="bts" onclick="generateProblem()">Generate New Problem</button>
                        <button class="bts" onclick="checkSolution()">Check My Solution</button>
                    </div>

                    <div id="result" class="result-container"></div>
                </div>
            </div>




            <!-- <div id="code-snippets" class="page">
          <h1>Python Code Snippets</h1>
          <p class="subtitle">Practice completing code snippets to improve your Python skills</p>
          
          <div class="code-snippet-section">
            <p>These code snippets are generated using a fine-tuned CodeGen model specifically designed for kids aged 10-13. Complete the code to improve your Python skills!</p>
             -->
            <!-- This is where the code snippet tutor will be initialized -->
            <!-- <div id="code-snippet-container" class="code-snippet-container"> -->
            <!-- CodeSnippetTutor will be loaded here -->
            <!-- </div>
          </div>
        </div> -->

            <!-- Achievements Page -->
            <!-- <div id="achievements" class="page">
          <h1>Achievements</h1>
          <p class="subtitle">Your coding milestones and badges</p>
          
          <div class="achievements-grid">
            <div class="achievement-card">
              <div class="badge">üèÜ</div>
              <h3>Python Master</h3>
              <p>Completed all Python courses</p>
            </div>
            
            <div class="achievement-card locked">
              <div class="badge">üåü</div>
              <h3>Web Wizard</h3>
              <p>Complete the web development track</p>
            </div>
            
            <div class="achievement-card">
              <div class="badge">üí™</div>
              <h3>30-Day Streak</h3>
              <p>Coded for 30 days in a row</p>
            </div>
          </div>
        </div> -->

            <!-- My Progress Page -->
            <!-- <div id="my-progress" class="page">
          <h1>My Progress</h1>
          <p class="subtitle">Track your learning journey</p>
          
          <div class="progress-stats">
            <div class="stat-card">
              <h3>Courses Completed</h3>
              <div class="stat">12</div>
            </div>
            
            <div class="stat-card">
              <h3>Hours Learned</h3>
              <div class="stat">156</div>
            </div>
            
            <div class="stat-card">
              <h3>Current Streak</h3>
              <div class="stat">7 days</div>
            </div>
          </div>
          
          <div class="progress-chart">
            <h3>Learning Activity</h3>
            <div class="chart-placeholder"></div>
          </div>
        </div> -->

            <!-- Settings Page -->
            <div id="settings" class="page">
                <h1>Settings</h1>
                <p class="subtitle">Customize your learning experience</p>

                <div class="settings-section">
                    <h3>Account Settings</h3>
                    <div class="setting-item">
                        <label>Email Notifications</label>
                        <label class="switch">
                            <input type="checkbox" checked>
                            <span class="slider"></span>
                        </label>
                    </div>

                    <div class="setting-item">
                        <label>Dark Mode</label>
                        <label class="switch">
                            <input type="checkbox">
                            <span class="slider"></span>
                        </label>
                    </div>

                    <div class="setting-item">
                        <label>Language</label>
                        <select>
                            <option>English</option>
                            <option>Spanish</option>
                            <option>French</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Help & Support Page -->
            <div id="help-support" class="page">
                <h1>Help & Support</h1>
                <p class="subtitle">Get assistance with your learning journey</p>

                <div class="help-section">
                    <div class="faq-section">
                        <h3>Frequently Asked Questions</h3>
                        <div class="faq-item">
                            <h4>How do I reset my password?</h4>
                            <p>Click on the "Forgot Password" link on the login page and follow the instructions
                                sent to your email.</p>
                        </div>
                        <div class="faq-item">
                            <h4>How do I track my progress?</h4>
                            <p>Visit the "My Progress" section to view detailed statistics about your learning
                                journey.</p>
                        </div>
                    </div>

                    <div class="contact-section">
                        <h3>Contact Support</h3>
                        <form class="contact-form">
                            <input type="text" placeholder="Subject">
                            <textarea placeholder="Describe your issue..."></textarea>
                            <button class="btn">Send Message</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Exercises Page -->
            <div id="exercises" class="page">
                <h1>Python Exercises</h1>
                <!-- <p class="subtitle">Test your Python skills through interactive quizzes!</p> -->

                <!-- <div class="games-grid">
            <div id="quiz-start" class="game-card detective-card>
              <h3>MCQuiz</h>
              <p> Ready to solve some Python mysteries? Click below to start your quiz!</p>
              <button id="start-quiz-btn" class="btn" >
                Start Quiz
              </button>
            </div>
          </div> -->

                <div class="games-grid">
                    <div id="quiz-start" class="game-card detective-card">
                        <h3>MCQuiz</h3>
                        <p>Ready to solve some Python mysteries? Click below to start your quiz!</p>
                        <!-- <p>Perfect for ages 10-13 to learn programming concepts!</p> -->
                        <br>
                        <button class="btn" id="start-quiz-btn">Start Quiz</button>
                    </div>


                    <div id="quiz-container" class="quiz-container" style="display:none;">
                        <div id="question-container" class="question-container">
                            <h2 id="question-text">Question will appear here</h2>
                            <div id="answer-buttons" class="answer-buttons">
                                <button class="btn answer-btn">Answer 1</button>
                                <button class="btn answer-btn">Answer 2</button>
                                <button class="btn answer-btn">Answer 3</button>
                                <button class="btn answer-btn">Answer 4</button>
                            </div>
                        </div>
                        <div id="result-container" class="result-container" style="display:none;">
                            <h2>Quiz Completed!</h2>
                            <p id="final-score">Your Score: 0/0</p>
                            <button id="restart-quiz-btn" class="btn">Try Again</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="script.js"></script>
    <script src="auth.js" defer></script>
    <script src="script1.js" defer></script>
    <script src="script_bot.js" defer></script>
    <!-- <script src="script4.js" defer></script> -->
    <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>

    <!-- Add Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ace-builds@1.4.12/src-min-noconflict/ace.js"></script>
    <script src="script2.js"></script>
    <script src="script3.js"></script>
    <!-- Add progress tracker after other scripts -->
    <script src="progress_tracker.js"></script>
    <script src="script4.js"></script>
    <!-- <script>
        async function generateProblem() {
            try {
                // Show loading
                document.getElementById("problem").innerHTML = 
                    "<p style='color: blue;'>üîÑ Generating new problem...</p>";
                    
                const res = await fetch("/generate");
                const data = await res.json();
                
                if (data.status === "error") {
                    document.getElementById("problem").innerHTML = 
                        "<p style='color: red;'>Error generating problem. Please try again.</p>";
                    return;
                }
                
                document.getElementById("problem").innerHTML = 
                    `<pre><strong>${data.problem}</strong>\n\n${data.truncated}</pre>`;
                document.getElementById("result").innerHTML = "";
                document.getElementById("user_code").value = "";
                
                // Clear any previous sections
                const existingSections = document.querySelectorAll("#instructions");
                existingSections.forEach(section => section.remove());
                
            } catch (error) {
                console.error("Error generating problem:", error);
                document.getElementById("problem").innerHTML = 
                    "<p style='color: red;'>Error generating problem. Please try again.</p>";
            }
        }

        async function checkSolution() {
            const userCode = document.getElementById("user_code").value;
            
            if (!userCode.trim()) {
                document.getElementById("result").innerHTML = 
                    "<p style='color: orange;'>‚ö†Ô∏è Please enter your code before checking.</p>";
                return;
            }
            
            // Show evaluation message
            document.getElementById("result").innerHTML = 
                "<p style='color: blue;'>üîÑ Comparing your solution with the model solution...</p>";
            
            try {
                const res = await fetch("/evaluate", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ user_code: userCode })
                });
                
                const data = await res.json();
                
                const resultDiv = document.getElementById("result");
                
                // Simple feedback based on correctness
                if (data.is_correct) {
                    resultDiv.innerHTML = 
                        `<div style="background-color: #d4edda; border: 1px solid #c3e6cb; border-radius: 6px; padding: 15px; margin: 10px 0;">
                            <p style="color: #155724; font-size: 18px; font-weight: bold; margin: 0 0 10px 0;">‚úÖ ${data.feedback}</p>
                            <p style="color: #155724; margin: 0;">Great job! Your solution produces the same results as the model solution.</p>
                        </div>`;
                } else {
                    resultDiv.innerHTML = 
                        `<div style="background-color: #f8d7da; border: 1px solid #f5c6cb; border-radius: 6px; padding: 15px; margin: 10px 0;">
                            <p style="color: #721c24; font-size: 18px; font-weight: bold; margin: 0 0 10px 0;">‚ùå ${data.feedback}</p>
                            <details style="margin-top: 15px;">
                                <summary style="cursor: pointer; font-weight: bold; color: #721c24;">üí° Show Expected Solution Structure</summary>
                                <pre style="background-color: #f5f5f5; padding: 10px; border-radius: 4px; margin-top: 10px; overflow-x: auto;">${data.suggested_code}</pre>
                            </details>
                        </div>`;
                }
                    
            } catch (error) {
                console.error("Error checking solution:", error);
                document.getElementById("result").innerHTML = 
                    "<p style='color: red;'>Error checking solution. Please try again.</p>";
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            // Ctrl+Enter to check solution
            if (event.ctrlKey && event.key === 'Enter') {
                event.preventDefault();
                checkSolution();
            }
            // Ctrl+N for new problem
            if (event.ctrlKey && event.key === 'n') {
                event.preventDefault();
                generateProblem();
            }
        });

        // Instructions for users
        function showInstructions() {
            const instructions = `
        <div id="instructions" style="background-color: #e8f4fd; padding: 15px; margin: 10px 0; border: 1px solid #b8d4ea; border-radius: 8px;">
            <h4 style="margin-top: 0; color: #1a5490;">üìö Model-Based Code Exercise System</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 15px;">
                <div>
                    <h5 style="margin: 0 0 8px 0; color: #2c5282;">üéØ How It Works:</h5>
                    <ul style="margin: 0; padding-left: 18px; color: #2c5282;">
                        <li><strong>Model Comparison:</strong> Your solution is compared directly with an AI-generated model solution</li>
                        <li><strong>Sample Testing:</strong> Tests your code with various inputs against the model</li>
                        <li><strong>Smart Feedback:</strong> Shows exactly where your output differs from expected</li>
                    </ul>
                </div>
                <div>
                    <h5 style="margin: 0 0 8px 0; color: #2c5282;">‚å®Ô∏è Keyboard Shortcuts:</h5>
                    <ul style="margin: 0; padding-left: 18px; color: #2c5282;">
                        <li><strong>Ctrl + Enter:</strong> Check your solution</li>
                        <li><strong>Ctrl + N:</strong> Generate new problem</li>
                    </ul>
                </div>
            </div>
            <p style="margin: 0; font-style: italic; color: #2c5282; text-align: center;">
                ü§ñ Your solution just needs to produce the same results as the AI model - multiple approaches accepted!
            </p>
        </div>`;
            
            const problemDiv = document.getElementById("problem");
            problemDiv.insertAdjacentHTML('beforebegin', instructions);
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            showInstructions();
            generateProblem();
        });

        // Auto-resize textarea
        document.addEventListener('DOMContentLoaded', function() {
            const textarea = document.getElementById('user_code');
            if (textarea) {
                textarea.addEventListener('input', function() {
                    this.style.height = 'auto';
                    this.style.height = this.scrollHeight + 'px';
                });
            }
        });
    </script>
    <script>
      // Sidebar navigation logic
      document.querySelectorAll('.nav-item[data-page]').forEach(function(btn) {
        btn.addEventListener('click', function() {
          // Remove 'active' class from all nav items
          document.querySelectorAll('.nav-item[data-page]').forEach(function(b) {
            b.classList.remove('active');
          });
          // Add 'active' class to the clicked nav item
          btn.classList.add('active');

          // Hide all pages
          document.querySelectorAll('.main-content .page').forEach(function(page) {
            page.classList.remove('active');
          });
          // Show the selected page
          var pageId = btn.getAttribute('data-page');
          var pageElem = document.getElementById(pageId);
          if (pageElem) {
            pageElem.classList.add('active');
          }
        });
      });
    </script> -->
    <!-- Initialize the Code Snippet Tutor -->
    <!-- <script>
      // Wait for the DOM to be fully loaded
      document.addEventListener('DOMContentLoaded', function() {
        // Initialize the Code Snippet Tutor when the page is loaded
        const tutor = new CodeSnippetTutor({
          apiBaseUrl: 'http://127.0.0.1:8000',
          containerSelector: '#code-snippet-container',
          autoFocus: true,
          useMockData: window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
        });
        
        // Generate a problem by default when the code snippets page is opened
        document.querySelector('.nav-item[data-page="code-snippets"]').addEventListener('click', function() {
          // Wait for the page transition and then generate a problem
          setTimeout(() => {
            if (tutor && typeof tutor.generateProblem === 'function') {
              tutor.generateProblem();
            }
          }, 300);
        });
      });


    </script> -->

    <!-- <script src="{{ url_for('static', filename='script4.js') }}"
    defer
  ></script> -->

    <script>
        function unlockBadge(index) {
            const badges = document.querySelectorAll('.detective-badge');
            if (badges[index] && badges[index].classList.contains('locked')) {
                badges[index].classList.remove('locked');
                badges[index].classList.add('earned');
            }
        }

        // Example usage after user completes a level:
        function onCaseSolved(score, timeTaken, errors) {
            if (score >= 1) unlockBadge(0); // First solve
            if (timeTaken < 60) unlockBadge(1); // Speed Demon
            if (errors === 0 && score >= 5) unlockBadge(2); // Perfectionist
            if (score >= 10) unlockBadge(3); // Master Detective
        }
    </script>

    <!-- ... existing code ...
  
  <script>
    // Initialize dashboard animations
    document.addEventListener('DOMContentLoaded', function() {
      // Animate progress bars
      document.querySelectorAll('.progress-animation').forEach(function(element) {
        setTimeout(function() {
          element.style.width = element.getAttribute('data-width');
        }, 500);
      });
      
      // Counter animation for stats
      document.querySelectorAll('.counter-animation').forEach(function(counter) {
        const target = parseInt(counter.getAttribute('data-target'));
        const duration = 1500; // ms
        const steps = 30;
        const stepValue = target / steps;
        let current = 0;
        const timer = setInterval(function() {
          current += stepValue;
          if (current > target) {
            counter.textContent = target;
            clearInterval(timer);
          } else {
            counter.textContent = Math.floor(current);
          }
        }, duration / steps);
      });
    });
    
    // Page navigation
    document.querySelectorAll('.nav-item').forEach(function(button) {
      button.addEventListener('click', function() {
        // Get the page to show
        const pageId = this.getAttribute('data-page');
        
        // Hide all pages
        document.querySelectorAll('.page').forEach(function(page) {
          page.classList.remove('active');
        });
        
        // Show the selected page
        document.getElementById(pageId).classList.add('active');
        
        // Update active nav item
        document.querySelectorAll('.nav-item').forEach(function(navItem) {
          navItem.classList.remove('active');
        });
        this.classList.add('active');
        
        // Reinitialize animations if dashboard is shown
        if (pageId === 'dashboard') {
          // Reset and restart progress animations
          document.querySelectorAll('.progress-animation').forEach(function(element) {
            element.style.width = '0%';
            setTimeout(function() {
              element.style.width = element.getAttribute('data-width');
            }, 300);
          });
          
          // Reset and restart counter animations
          document.querySelectorAll('.counter-animation').forEach(function(counter) {
            const target = parseInt(counter.getAttribute('data-target'));
            counter.textContent = '0';
            const duration = 1500; // ms
            const steps = 30;
            const stepValue = target / steps;
            let current = 0;
            const timer = setInterval(function() {
              current += stepValue;
              if (current > target) {
                counter.textContent = target;
                clearInterval(timer);
              } else {
                counter.textContent = Math.floor(current);
              }
            }, duration / steps);
          });
        }
      });
    });
  </script> -->

    <script>
        // Animation for progress bars
        document.addEventListener('DOMContentLoaded', function () {
            // Animate progress bars
            setTimeout(() => {
                document.querySelectorAll('.progress-animation').forEach(el => {
                    const width = el.getAttribute('data-width');
                    el.style.width = width;
                });
            }, 500);

            // Counter animation
            document.querySelectorAll('.counter-animation').forEach(counter => {
                const target = parseInt(counter.getAttribute('data-target'));
                const duration = 1500;
                const step = target / (duration / 50);
                let current = 0;

                const updateCounter = () => {
                    current += step;
                    if (current < target) {
                        counter.textContent = Math.floor(current);
                        setTimeout(updateCounter, 50);
                    } else {
                        counter.textContent = target;
                    }
                };

                setTimeout(() => {
                    updateCounter();
                }, 500);
            });
        });
    </script>

    <script>

        // XP Calculation System
        const XP_RATES = {
            EXERCISE_COMPLETION: 50,
            EXERCISE_SCORE_MULTIPLIER: 2,
            DEBUGGING_CHALLENGE: 75,
            CODING_PROBLEM: 100,
            VIDEO_COMPLETION: 25,
            AI_VISUALIZATION: 30,
            DAILY_STREAK_BONUS: 20,
            PERFECT_SCORE_BONUS: 100
        };

        // Badge System
        const BADGES = {
            'first-steps': { name: 'First Steps', icon: 'üë∂', requirement: 'Complete first exercise', earned: false },
            'problem-solver': { name: 'Problem Solver', icon: 'üß©', requirement: 'Solve 10 problems', earned: false },
            'debugging-master': { name: 'Debug Master', icon: 'üïµÔ∏è', requirement: 'Complete 20 debugging challenges', earned: false },
            'video-watcher': { name: 'Avid Learner', icon: 'üìö', requirement: 'Watch 5 videos', earned: false },
            'creative-mind': { name: 'Creative Mind', icon: 'üé®', requirement: 'Create 15 visualizations', earned: false },
            'streak-warrior': { name: 'Streak Warrior', icon: 'üî•', requirement: '7-day streak', earned: false },
            'perfectionist': { name: 'Perfectionist', icon: 'üíé', requirement: 'Perfect score on exercise', earned: false },
            'explorer': { name: 'Explorer', icon: 'üó∫Ô∏è', requirement: 'Try all activities', earned: false }
        };

        let userData = null;

        // Calculate total XP from user data
        function calculateTotalXP(data) {
            let totalXP = 0;

            // Exercise XP
            const exercises = data.progress?.exercises || {};
            totalXP += (exercises.completed || 0) * XP_RATES.EXERCISE_COMPLETION;
            totalXP += (exercises.totalScore || 0) * XP_RATES.EXERCISE_SCORE_MULTIPLIER;

            // Debugging game XP
            const debugging = data.progress?.games?.debuggingDetective || {};
            totalXP += (debugging.challengesCompleted || 0) * XP_RATES.DEBUGGING_CHALLENGE;

            // Coding exercise XP
            const coding = data.progress?.games?.codingExercise || {};
            totalXP += (coding.problemsSolved || 0) * XP_RATES.CODING_PROBLEM;

            // Video XP
            const videos = data.progress?.videoLessons || {};
            totalXP += (videos.totalCompleted || 0) * XP_RATES.VIDEO_COMPLETION;

            // AI Artist XP
            const aiArtist = data.progress?.games?.aiArtist || {};
            totalXP += (aiArtist.visualizationsCreated || 0) * XP_RATES.AI_VISUALIZATION;

            return totalXP;
        }

        // Check and update badges
        function updateBadges(data) {
            const exercises = data.progress?.exercises || {};
            const debugging = data.progress?.games?.debuggingDetective || {};
            const coding = data.progress?.games?.codingExercise || {};
            const videos = data.progress?.videoLessons || {};
            const aiArtist = data.progress?.games?.aiArtist || {};

            // Update badge requirements
            BADGES['first-steps'].earned = (exercises.completed || 0) >= 1;
            BADGES['problem-solver'].earned = (coding.problemsSolved || 0) >= 10;
            BADGES['debugging-master'].earned = (debugging.challengesCompleted || 0) >= 20;
            BADGES['video-watcher'].earned = (videos.totalCompleted || 0) >= 5;
            BADGES['creative-mind'].earned = (aiArtist.visualizationsCreated || 0) >= 15;
            BADGES['perfectionist'].earned = (exercises.totalScore || 0) >= XP_RATES.PERFECT_SCORE_BONUS;
            BADGES['explorer'].earned = (exercises.completed || 0) > 0 && (debugging.challengesCompleted || 0) > 0 && (coding.problemsSolved || 0) > 0;

            // Render badges
            renderBadges();
        }

        // Render badges in the UI
        function renderBadges() {
            const container = document.getElementById('badgesContainer');
            container.innerHTML = '';

            Object.entries(BADGES).forEach(([key, badge]) => {
                const badgeEl = document.createElement('div');
                badgeEl.className = `badge ${badge.earned ? 'earned' : 'locked'}`;
                badgeEl.innerHTML = `
                    <div class="badge-icon">${badge.icon}</div>
                    <div class="badge-name">${badge.name}</div>
                `;
                badgeEl.title = badge.requirement;
                container.appendChild(badgeEl);
            });
        }

        // Update progress rings
        function updateProgressRing(ringId, percentage) {
            const ring = document.getElementById(ringId);
            if (ring && ring.r && ring.r.baseVal) {
                const radius = ring.r.baseVal.value;
                const circumference = radius * 2 * Math.PI;
                const offset = circumference - (percentage / 100 * circumference);

                ring.style.strokeDasharray = circumference;
                ring.style.strokeDashoffset = offset;
            } else {
                console.warn(`Progress ring with id "${ringId}" is missing or invalid.`);
            }
        }


        // Load and display user data
        async function loadDashboard() {
            try {
                // Check if progress tracker is available
                if (!window.CodeSafariProgressTracker) {
                    throw new Error('Progress tracker not loaded');
                }

                // Get user data
                userData = await window.CodeSafariProgressTracker.getUserData();

                if (!userData) {
                    throw new Error('No user data found');
                }

                console.log('Loaded user data:', userData);

                // Update welcome banner
                document.getElementById('welcomeText').textContent =
                    `Welcome back, ${userData.displayName || 'Coder'}!`;

                // Calculate and display XP
                const totalXP = calculateTotalXP(userData);
                document.getElementById('totalXP').textContent = totalXP.toLocaleString();

                // Update exercise stats
                const exercises = userData.progress?.exercises || {};
                document.getElementById('exercisesCompleted').textContent = exercises.completed || 0;
                document.getElementById('exerciseScore').textContent = `${exercises.totalScore || 0} total points`;

                // Update game stats
                const debugging = userData.progress?.games?.debuggingDetective || {};
                const coding = userData.progress?.games?.codingExercise || {};
                const aiArtist = userData.progress?.games?.aiArtist || {};

                // Games played calculation
                const gamesPlayed = (debugging.challengesCompleted || 0) +
                    (coding.problemsSolved || 0) +
                    (aiArtist.visualizationsCreated || 0);
                document.getElementById('gamesPlayed').textContent = gamesPlayed;

                const totalGameScore = (debugging.score || 0) + (coding.score || 0);
                document.getElementById('gameScore').textContent = `${totalGameScore} total score`;

                // Update video progress
                const videos = userData.progress?.videoLessons || {};
                const videoProgress = videos.progressPercentage || 0;
                document.getElementById('videoProgressText').textContent = `${videoProgress}%`;
                updateProgressRing('videoProgressRing', videoProgress);

                // Update individual game cards
                document.getElementById('debuggingLevel').textContent = `Level ${debugging.level || 1}`;
                document.getElementById('debuggingScore').textContent = debugging.score || 0;
                document.getElementById('debuggingChallenges').textContent = debugging.challengesCompleted || 0;
                // updateProgressRing('debuggingProgress', Math.min((debugging.challengesCompleted || 0) * 5, 100));
                // Update debugging progress bar instead of ring
                const debuggingProgressBar = document.getElementById('debuggingProgress');
                if (debuggingProgressBar) {
                    debuggingProgressBar.style.width = `${Math.min((debugging.challengesCompleted || 0) * 2, 100)}%`;
                }
                document.getElementById('codingBestScore').textContent = `Best: ${coding.bestScore || 0}`;
                document.getElementById('codingScore').textContent = coding.score || 0;
                document.getElementById('problemsSolved').textContent = coding.problemsSolved || 0;

                document.getElementById('visualizationsCreated').textContent = aiArtist.visualizationsCreated || 0;
                const artistRank = (aiArtist.visualizationsCreated || 0) >= 10 ? 'Expert' :
                    (aiArtist.visualizationsCreated || 0) >= 5 ? 'Intermediate' : 'Beginner';
                document.getElementById('artistRank').textContent = artistRank;

                // Update overall progress
                const overallProgress = userData.progress?.overallProgress || 0;
                document.getElementById('overallProgressText').textContent = `${overallProgress}%`;
                document.getElementById('currentLesson').textContent = userData.progress?.currentLesson || 1;
                updateProgressRing('overallProgressRing', overallProgress);

                // Update encouragement text
                const encouragement = overallProgress >= 80 ? "Almost there! You're crushing it! üöÄ" :
                    overallProgress >= 50 ? "Great progress! Keep it up! üí™" :
                        overallProgress >= 25 ? "You're getting the hang of it! üìà" :
                            "Just getting started! üåü";
                document.getElementById('progressEncouragement').textContent = encouragement;

                // Update badges
                updateBadges(userData);

                // Show dashboard
                document.getElementById('loading').style.display = 'none';
                document.getElementById('dashboardContent').style.display = 'block';

                // Check for new achievements
                checkNewAchievements();
                console.log('Debugging data:', debugging);
                console.log('Coding data:', coding);
                console.log('AI Artist data:', aiArtist);
            } catch (error) {
                console.error('Error loading dashboard:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('errorMessage').style.display = 'block';
                document.getElementById('errorMessage').textContent =
                    `Failed to load dashboard: ${error.message}. Please make sure you're logged in and try refreshing the page.`;
            }
        }

        // Check for new achievements and show popup
        function checkNewAchievements() {
            const earnedBadges = Object.entries(BADGES).filter(([key, badge]) => badge.earned);
            if (earnedBadges.length > 0) {
                const randomBadge = earnedBadges[Math.floor(Math.random() * earnedBadges.length)];
                showAchievementPopup(`${randomBadge[1].icon} ${randomBadge[1].name} Unlocked!`);
            }
        }

        // Show achievement popup
        function showAchievementPopup(text) {
            const popup = document.getElementById('achievementPopup');
            document.getElementById('achievementText').textContent = text;
            popup.classList.add('show');

            setTimeout(() => {
                popup.classList.remove('show');
            }, 3000);
        }

        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', () => {
            // Wait for Firebase to be ready
            setTimeout(() => {
                loadDashboard();
            }, 1000);
        });

        // Auto-refresh dashboard every 30 seconds
        setInterval(() => {
            if (userData) {
                loadDashboard();
            }
        }, 30000);
    </script>

</body>

</html>